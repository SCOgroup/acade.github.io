{{/* Wowchemy View component for displaying content as a card. */}}
{{/* FINAL VERSION: Handles multiple layouts via 'project_type' flag. */}}

{{ $item := . }}
{{ $widget := .page }}

{{/* --- Default view settings --- */}}
{{ $show_authors := $widget.Params.show_authors | default false }}
{{ $show_buttons := $widget.Params.show_buttons | default true }}
{{ $show_date := $widget.Params.show_date | default true }}
{{ $show_stats := $widget.Params.show_stats | default true }}
{{ $show_summary := $widget.Params.show_summary | default true }}
{{ $show_tags := $widget.Params.show_tags | default true }}
{{ $summary := "" }}
{{ if $item.Params.summary }}{{ $summary = $item.Params.summary | markdownify | emojify }}{{ else if .Params.abstract }}{{ $summary = .Params.abstract | markdownify | emojify }}{{ else if $item.Summary }}{{ $summary = $item.Summary }}{{ end }}

<div class="card-simple">

  {{/* --- Feature Image (if exists) - This part remains unchanged --- */}}
  {{ $resource := ($item.Resources.ByType "image").GetMatch "*feature*" }}
  {{ if $resource }}
    {{ $image := $resource.Fit "550x350 q75" }}
    <a href="{{ $item.RelPermalink }}">
      <img src="{{ $image.RelPermalink }}" class="card-img-top" alt="" loading="lazy">
    </a>
  {{ end }}

  <div class="card-body">
    
    {{/* --- START OF CUSTOM LOGIC --- */}}
    {{ if eq .Params.project_type "科研项目" }}
      
      {{/* --- LAYOUT 1: Two-Column Layout for "科研项目" --- */}}
      <div class="project-layout-container" style="display: flex; align-items: center; width: 100%;">
        
        <!-- Left Column: Year Range -->
        <div class="project-year-col" style="flex: 0 0 110px; text-align: center; padding-right: 20px; border-right: 1px solid #eee;">
          <h4 style="margin: 0; font-size: 1.2rem; color: #333; font-weight: 500;">{{ .Params.year_range }}</h4>
        </div>
        
        <!-- Right Column: Project Details -->
        <div class="project-details-col" style="flex: 1; padding-left: 20px;">
          <h5 class="card-title" style="margin-bottom: 5px; font-size: 1.1rem;"><a href="{{ $item.RelPermalink }}">{{ $item.Title }}</a></h5>
          <div class="project-client" style="font-size: 0.9rem; color: #666;">{{ .Params.client }}</div>
        </div>

      </div>

    {{ else }}
      
      {{/* --- LAYOUT 2: Default layout for all other items (old projects, blog posts) --- */}}
      <h4 class="card-title"><a href="{{ $item.RelPermalink }}">{{ $item.Title }}</a></h4>
      
      {{ if and $show_date $item.Date }}
        <div class="card-date">
          {{ $item.Date.Format (or $widget.Params.date_format "Jan 2, 2006") }}
        </div>
      {{ end }}

      {{ if and $show_summary (ne (striptags $summary) "") }}
        <p class="card-text">{{ $summary | truncate 150 }}</p>
      {{ end }}

    {{ end }}
    {{/* --- END OF CUSTOM LOGIC --- */}}

    {{/* --- Common elements (tags, etc.) can be placed here if needed for both layouts --- */}}
    {{ if and $show_tags $item.Params.tags }}
      <div class="card-tags" style="margin-top: 15px;">
        {{ partial "page_metadata_tags" $item }}
      </div>
    {{ end }}
    
  </div>
</div>
